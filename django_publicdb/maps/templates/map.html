{% load fix_strings %}
{% load static %}

<!DOCTYPE html>
<html>

<head>
    <link rel="icon" type="image/vnd.microsoft.icon" href="{% static 'favicon.ico' %}">
    <meta charset="utf-8">
    <title>HiSPARC Station map</title>
    <link rel="stylesheet" type="text/css" media="all" href="{% static 'styles/base.css' %}">
    <link rel="stylesheet" type="text/css" media="all" href="{% static 'styles/OpenLayers-2.12.css' %}">
    <link rel="stylesheet" type="text/css" media="all" href="{% static 'styles/map_controls.css' %}">
    <link rel="stylesheet" type="text/css" media="all" href="{% static 'styles/maps.css' %}">
    <script src="{% static 'scripts/jquery-1.8.2.min.js' %}"></script>
    <script src="{% static 'scripts/jquery.flot-0.8a.min.js' %}"></script>
    <script src="{% static 'scripts/jquery.flot.axislabels.min.js' %}"></script>
    <script src="{% static 'scripts/jquery.flot.time.js' %}"></script>
    <script src="{% static 'scripts/OpenLayers-2.13b.min.js' %}"></script>
    <script src="{% static 'scripts/OpenLayersHisparcMap.js' %}"></script>
    <!--[if lte IE 8]><script src="{% static 'scripts/excanvas.min.js' %}"></script><![endif]-->
    <script>
        $(document).ready(function() {
            var map = createMap("map");
            var style = createStyle(map);

            {% if center %}
                map.setCenter(new OpenLayers.LonLat({{ center.longitude }}, {{ center.latitude }}).transform(fromProjection, toProjection), 17);
            {% else %}
                map.setCenter(new OpenLayers.LonLat(4.950, 52.355).transform(fromProjection, toProjection), 5);
            {% endif %}

            {% for subcluster in subclusters %}
                var {{ subcluster.name|slugify|remove_hyphens }} = new OpenLayers.Layer.Vector("{{ subcluster.name }}", {styleMap: new OpenLayers.StyleMap(style)});
                    {% for station in subcluster.stations %}
                        {% if station.longitude and station.latitude %}
                            var feature = new OpenLayers.Feature.Vector(
                                new OpenLayers.Geometry.Point({{ station.longitude }}, {{ station.latitude }})
                                                       .transform(fromProjection, toProjection),
                                {id: {{ station.number }},
                                 name: "{{ station.name }}",
                                 subcluster: "{{ station.cluster }}",
                                 cluster: "{{ station.cluster.parent }}",
                                 status: "{{ station.status }}"});
                            {{ subcluster.name|slugify|remove_hyphens }}.addFeatures(feature);
                        {% endif %}
                    {% endfor %}
                map.addLayer({{ subcluster.name|slugify|remove_hyphens }});
            {% endfor %}
            // Zoom to fit cluster
            {% if focus %}
                {% for layer in focus %}
                    {% if forloop.first %}
                        var bounds = {{ layer|slugify|remove_hyphens }}.getDataExtent();
                    {% else %}
                        bounds.extend({{ layer|slugify|remove_hyphens }}.getDataExtent());
                    {% endif %}
                {% endfor %}
                if (bounds) {
                    map.zoomToExtent(bounds);
                    map.zoomTo(Math.floor(map.getZoom()));}
            {% endif %}
        });
    </script>
</head>

<body>
<div id="map"></div>
</body>

</html>
