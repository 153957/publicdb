<canvas id="station_layout" width="600" height="600"></canvas>

<script>
    var canvas = document.getElementById('station_layout');
    var context = canvas.getContext('2d');
    var colors = ['black', 'red', 'green', 'blue'];

    function radians(degrees) {
        return degrees * Math.PI / 180;}

    function draw_gps(ctx) {
        var size = .2;
        ctx.fillStyle = 'blue';
        ctx.fillRect(-size / 2, -size / 2, size, size);}

    function draw_detector(ctx, r, alpha, beta, color) {
        /* Draw a detector defined by r, alpha, beta coordinates on the canvas
        */
        var detector_width = .5;
        var detector_height = 1;

        ctx.lineWidth = 1;  
        ctx.rotate(radians(alpha));
        ctx.translate(0, -r);
        ctx.rotate(-radians(alpha));
        ctx.rotate(radians(beta));
        ctx.fillStyle = color;
        ctx.fillRect(-detector_width / 2, -detector_height / 2,
                     detector_width, detector_height);
        ctx.restore();
        ctx.save();}

    function calculate_bounds(r, alpha) {
        /* Calculate the bounding box to contain the detectors and gps
        */
        var min_x = 0, max_x = 0, min_y = 0, max_y = 0;
        var margin = 1;  // To ensure the detectors will fit
        for (var i = 0; i < r.length; i++) {
            x = Math.sin(radians(alpha[i])) * r[i];
            min_x = Math.min(x, min_x);
            max_x = Math.max(x, max_x);
            y = Math.cos(radians(alpha[i])) * r[i];
            min_y = Math.min(y, min_y);
            max_y = Math.max(y, max_y);}
        min_x -= margin;
        max_x += margin;
        min_y -= margin;
        max_x += margin;
        return [min_x, max_x, min_y, max_y];}

    function draw_station(ctx, r, alpha, beta) {
        /* Draw a station on the canvas

        r, alpha, beta should be equal length lists with the coordinates.

        */
        clear_canvas(ctx);
        var bounds = calculate_bounds(r, alpha);
        var station_width = bounds[1] - bounds[0];
        var station_height = bounds[3] - bounds[2];
        var scale = Math.min(canvas.width / station_width,
                             canvas.height / station_height);
        ctx.scale(scale, scale);
        ctx.translate(bounds[0], -bounds[3]);
        ctx.save();
        draw_gps(ctx);
        for (var i = 0; i < r.length; i++) {
            draw_detector(ctx, r[i], alpha[i], beta[i], colors[i]);}}

    function clear_canvas(ctx) {
        /* Clear objects on the canvas

        from: http://stackoverflow.com/a/6722031/1033535

        */
        ctx.save();
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.restore();}
   
    draw_station(context, [10, 8.66, 5, 5], [0, 0, -90, 90], [0, 0, 0, 90]);
</script>
