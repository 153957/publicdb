# Do not create backups, it will result in many executables in /usr/local/bin
- name: Copy vpn/publicdb service scripts
  ansible.builtin.copy:
    src: vpn-scripts/
    dest: /usr/local/bin
    mode: 0755
  become: true
  notify: restart hisparcvpnd

- name: Install pip
  ansible.builtin.yum:
    name: python-pip
  become: true

- name: Install supervisord prerequisites
  ansible.builtin.yum:
    name: python-meld3
  become: true

- name: Install supervisor daemon
  ansible.builtin.pip:
    name: supervisor
  become: true

- name: Copy supervisord init script
  ansible.builtin.copy:
    src: supervisord
    dest: /etc/init.d/supervisord
    backup: yes
    owner: root
    group: root
    mode: 0755
  become: true

- name: Copy supervisord.conf
  ansible.builtin.copy:
    src: supervisord.conf
    dest: /etc/supervisord.conf
    backup: yes
    owner: root
    group: root
    mode: 0644
  become: true
  notify: Restart supervisord

- name: Start supervisord now and on boot
  ansible.builtin.service:
    name: supervisord
    state: started
    enabled: yes
  become: true

- name: Start hisparcvpnd
  community.general.supervisorctl:
    name: hisparcvpnd
    state: started
